langague: java



  jobs:
    include:
      - stage: test
        script: mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=ligerarthur_sample-application-students
      - script: mvn clean verify
      - script: mvn package -Dskiptest
      - script: docker build -t arthurliger/devops:api sample-application-http-api-server
      - script: docker build -t arthurliger/devops:db_changelog sample-application-db-changelog-job
      - stage: deploy
        script: echo "$DOCKERHUB_PASS" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - script: docker push arthurliger/devops:api
      - script: docker push arthurliger/devops:db_changelog


 

env:
  global:
    - secure: $DOCKER_PASS

services:
  - docker




addons:
  sonarcloud:
    organization: "ligerarthur" # the key of the org you chose at step #3
    token:
      secure: $SONARCLOUD_PASS # encrypted value of your token





cache:
  directories:
    - $HOME/.m2
